{"ast":null,"code":"var _jsxFileName = \"/home/mani/projects/jobportal/webapp/adminportal/src/projectadmin/LiveTracking/LiveTracking.js\";\nimport React, { Component } from \"react\";\nimport { compose } from \"recompose\";\nimport { withScriptjs, withGoogleMap, GoogleMap, Marker, InfoWindow, Polyline } from \"react-google-maps\";\nimport axios from 'axios';\nconst MapWithAMarker = compose(withGoogleMap)(props => {\n  console.log(\"props\", props.pathCoordinates);\n  const icon = {\n    url: 'https://images.vexels.com/media/users/3/154573/isolated/preview/bd08e000a449288c914d851cb9dae110-hatchback-car-top-view-silhouette-by-vexels.png',\n    scaledSize: new window.google.maps.Size(40, 40),\n    anchor: {\n      x: 20,\n      y: 20\n    }\n  };\n  return /*#__PURE__*/React.createElement(GoogleMap, {\n    defaultZoom: 18,\n    defaultCenter: props.pathCoordinates[props.pathCoordinates.length - 1],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 25,\n      columnNumber: 4\n    }\n  }, /*#__PURE__*/React.createElement(Polyline, {\n    path: props.pathCoordinates,\n    geodesic: true,\n    options: {\n      strokeColor: \"#ff2527\",\n      strokeOpacity: 0.75,\n      strokeWeight: 2\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 29,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(Marker, {\n    icon: icon,\n    position: props.pathCoordinates[props.pathCoordinates.length - 1],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 38,\n      columnNumber: 13\n    }\n  }));\n});\nexport default class LiveTracking extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      locations: [],\n      selectedMarker: false,\n      booking_id: props.match.params.booking_id,\n      bookingNum: \"\",\n      path: props.path,\n      velocity: 400,\n      progress: [],\n      initialDate: new Date(),\n      routeCoordinates: [],\n      bookingNum: \"\"\n    };\n  }\n\n  componentDidMount() {\n    this.getData();\n    var that = this;\n    setInterval(function () {\n      that.getData();\n    }, 3000);\n  } // getData(){\n  //   axios.get('/api/bookingmaster/get/routeCoordinates/'+this.state.booking_id)\n  //   .then(booking=>{\n  //     console.log(\"booking\",booking);\n  //     var routeCoordinates =booking.data[0].routeCoordinates.map(a=>{return{lat:a.latitude,lng:a.longitude}})\n  //     console.log(\"routeCoordinates\",routeCoordinates);\n  //     this.setState({\n  //       booking:booking.data[0],\n  //       bookingNum:booking.data[0].bookingId,\n  //       routeCoordinates\n  //     })\n  //   })\n  //   .catch(err=>{\n  //     console.log(\"err\",err)\n  //   })\n  // }\n\n\n  getDistance() {\n    // seconds between when the component loaded and now\n    const differentInTime = (new Date() - this.state.initialDate) / 1000; // pass to seconds\n\n    return differentInTime * this.state.velocity; // d = v*t -- thanks Newton!\n  }\n\n  getData() {\n    axios.get('/api/bookingmaster/get/routeCoordinates/' + this.state.booking_id).then(booking => {\n      this.setState({\n        bookingNum: booking.data[0].bookingId\n      });\n      const distance = this.getDistance();\n\n      if (!distance) {\n        return;\n      }\n\n      var path = [];\n\n      for (var i = 0; i < booking.data[0].routeCoordinates.length; i++) {\n        path.push({\n          lat: booking.data[0].routeCoordinates[i].latitude,\n          lng: booking.data[0].routeCoordinates[i].longitude,\n          distance: booking.data[0].routeCoordinates[i].distanceTravelled ? booking.data[0].routeCoordinates[i].distanceTravelled : 0\n        });\n      }\n\n      console.log(\"path\", path);\n      let progress = path.filter(coordinates => coordinates.distance < distance);\n      const nextLine = path.find(coordinates => coordinates.distance > distance);\n      console.log(\"progress\", progress);\n      console.log(\"nextLine\", nextLine);\n      let point1, point2;\n\n      if (nextLine) {\n        point1 = progress[progress.length - 1];\n        point2 = nextLine;\n      } else {\n        // it's the end, so use the latest 2\n        point1 = progress[progress.length - 2];\n        point2 = progress[progress.length - 1];\n      }\n\n      console.log(\"point1\", point1);\n      console.log(\"point2\", point2);\n      const point1LatLng = new window.google.maps.LatLng(point1.lat, point1.lng);\n      const point2LatLng = new window.google.maps.LatLng(point2.lat, point2.lng);\n      console.log(\"point1LatLng\", point1LatLng);\n      console.log(\"point2LatLng\", point2LatLng);\n      console.log(\"window.google.maps.geometry\", window.google.maps.geometry);\n      const angle = window.google.maps.geometry.spherical.computeHeading(point1LatLng, point2LatLng);\n      const actualAngle = angle - 90;\n      console.log(\"actualAngle\", actualAngle);\n      const markerUrl = 'https://images.vexels.com/media/users/3/154573/isolated/preview/bd08e000a449288c914d851cb9dae110-hatchback-car-top-view-silhouette-by-vexels.png';\n      const marker = document.querySelector(`[src=\"${markerUrl}\"]`);\n      console.log(\"marker\", marker);\n\n      if (marker) {\n        // when it hasn't loaded, it's null\n        marker.style.transform = `rotate(${actualAngle}deg)`;\n      }\n\n      this.setState({\n        routeCoordinates: progress\n      });\n    }).catch(err => {\n      console.log(\"err\", err);\n    });\n  }\n\n  render() {\n    console.log(\"routeCoordinates\", this.state.routeCoordinates);\n    return /*#__PURE__*/React.createElement(React.Fragment, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col-lg-12 col-md-12 col-sm-12 col-xs-12 NOPadding\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 153,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"section\", {\n      className: \"content\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 154,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"pageContent col-lg-12 col-md-12 col-sm-12 col-xs-12\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 155,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"box-header with-border col-lg-12 col-md-12 col-xs-12 col-sm-12 NOpadding-right\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 156,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"h4\", {\n      className: \"weighttitle col-lg-8 col-md-11 col-xs-11 col-sm-11\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 14\n      }\n    }, \"Tracking Map for Booking No. \", this.state.bookingNum)), this.state.routeCoordinates && this.state.routeCoordinates.length > 0 ? /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col-lg-12 col-md-12 col-xs-12 col-xs-12 text-center\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 160,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(MapWithAMarker, {\n      selectedMarker: this.state.selectedMarker,\n      markers: this.state.locations,\n      onClick: this.handleClick,\n      pathCoordinates: this.state.routeCoordinates,\n      googleMapURL: \"https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=geometry,drawing,places\",\n      loadingElement: /*#__PURE__*/React.createElement(\"div\", {\n        style: {\n          height: `100%`\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 167,\n          columnNumber: 33\n        }\n      }),\n      containerElement: /*#__PURE__*/React.createElement(\"div\", {\n        style: {\n          height: `650px`\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 168,\n          columnNumber: 35\n        }\n      }),\n      mapElement: /*#__PURE__*/React.createElement(\"div\", {\n        style: {\n          height: `100%`\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 169,\n          columnNumber: 29\n        }\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 161,\n        columnNumber: 15\n      }\n    })) : null))));\n  }\n\n}","map":{"version":3,"sources":["/home/mani/projects/jobportal/webapp/adminportal/src/projectadmin/LiveTracking/LiveTracking.js"],"names":["React","Component","compose","withScriptjs","withGoogleMap","GoogleMap","Marker","InfoWindow","Polyline","axios","MapWithAMarker","props","console","log","pathCoordinates","icon","url","scaledSize","window","google","maps","Size","anchor","x","y","length","strokeColor","strokeOpacity","strokeWeight","LiveTracking","constructor","state","locations","selectedMarker","booking_id","match","params","bookingNum","path","velocity","progress","initialDate","Date","routeCoordinates","componentDidMount","getData","that","setInterval","getDistance","differentInTime","get","then","booking","setState","data","bookingId","distance","i","push","lat","latitude","lng","longitude","distanceTravelled","filter","coordinates","nextLine","find","point1","point2","point1LatLng","LatLng","point2LatLng","geometry","angle","spherical","computeHeading","actualAngle","markerUrl","marker","document","querySelector","style","transform","catch","err","render","handleClick","height"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\"\nimport { compose } from \"recompose\"\nimport {\n  withScriptjs,\n  withGoogleMap,\n  GoogleMap,\n  Marker,\n  InfoWindow,\n  Polyline\n} from \"react-google-maps\";\nimport axios from 'axios';\n\n\nconst MapWithAMarker = compose(withGoogleMap)(props => {\n  console.log(\"props\",props.pathCoordinates);\n const icon = {\n    url:\n      'https://images.vexels.com/media/users/3/154573/isolated/preview/bd08e000a449288c914d851cb9dae110-hatchback-car-top-view-silhouette-by-vexels.png',\n      scaledSize: new window.google.maps.Size(40, 40),\n      anchor: { x: 20, y: 20 }\n  };\n\n\n  return (\n   <GoogleMap\n             defaultZoom={18} defaultCenter={props.pathCoordinates[props.pathCoordinates.length-1]}\n        >\n            {/*for creating path with the updated coordinates*/}\n            <Polyline\n                path={props.pathCoordinates}\n                geodesic={true}\n                options={{\n                    strokeColor: \"#ff2527\",\n                    strokeOpacity: 0.75,\n                    strokeWeight: 2,\n                }}\n            />\n            <Marker\n              icon={icon}\n              position={props.pathCoordinates[props.pathCoordinates.length - 1]}\n            />\n        </GoogleMap>\n  )\n})\n\n\nexport default class LiveTracking  extends Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      locations: [],\n      selectedMarker: false,\n      booking_id : props.match.params.booking_id,\n      bookingNum:\"\",\n      path:props.path,\n      velocity : 400,\n      progress: [],\n      initialDate : new Date(),\n      routeCoordinates:[],\n      bookingNum: \"\",\n    }\n  }\n  componentDidMount(){\n    this.getData();\n    var that = this;\n      setInterval(function(){\n        that.getData();\n      }, 3000);\n  }\n\n  // getData(){\n  //   axios.get('/api/bookingmaster/get/routeCoordinates/'+this.state.booking_id)\n  //   .then(booking=>{\n  //     console.log(\"booking\",booking);\n  //     var routeCoordinates =booking.data[0].routeCoordinates.map(a=>{return{lat:a.latitude,lng:a.longitude}})\n  //     console.log(\"routeCoordinates\",routeCoordinates);\n  //     this.setState({\n  //       booking:booking.data[0],\n  //       bookingNum:booking.data[0].bookingId,\n  //       routeCoordinates\n  //     })\n  //   })\n  //   .catch(err=>{\n  //     console.log(\"err\",err)\n  //   })\n  // }\n getDistance(){\n    // seconds between when the component loaded and now\n    const differentInTime = (new Date() - this.state.initialDate) / 1000 // pass to seconds\n    return differentInTime * this.state.velocity // d = v*t -- thanks Newton!\n  }\n\n  getData(){\n    axios.get('/api/bookingmaster/get/routeCoordinates/'+this.state.booking_id)\n    .then(booking=>{\n        this.setState({bookingNum:booking.data[0].bookingId})\n       const distance = this.getDistance()\n        if (! distance) {\n          return\n        }\n        var path = [];\n        for (var i = 0; i < booking.data[0].routeCoordinates.length; i++) {\n          path.push({lat:booking.data[0].routeCoordinates[i].latitude,lng:booking.data[0].routeCoordinates[i].longitude,distance:booking.data[0].routeCoordinates[i].distanceTravelled ? booking.data[0].routeCoordinates[i].distanceTravelled : 0})\n        }\n        console.log(\"path\",path);\n\n        let progress = path.filter(coordinates => coordinates.distance < distance)\n\n        const nextLine = path.find(coordinates => coordinates.distance > distance)\n        console.log(\"progress\",progress);\n        console.log(\"nextLine\",nextLine);\n        let point1, point2\n\n        if (nextLine) {\n          point1 = progress[progress.length - 1]\n          point2 = nextLine\n        } else {\n          // it's the end, so use the latest 2\n          point1 = progress[progress.length - 2]\n          point2 = progress[progress.length - 1]\n        }\n        \n        console.log(\"point1\",point1);\n        console.log(\"point2\",point2);\n        const point1LatLng = new window.google.maps.LatLng(point1.lat, point1.lng)\n        const point2LatLng = new window.google.maps.LatLng(point2.lat, point2.lng)\n        console.log(\"point1LatLng\",point1LatLng);\n        console.log(\"point2LatLng\",point2LatLng);\n        console.log(\"window.google.maps.geometry\",window.google.maps.geometry);\n        const angle = window.google.maps.geometry.spherical.computeHeading(point1LatLng, point2LatLng)\n        const actualAngle = angle - 90\n        console.log(\"actualAngle\",actualAngle)\n\n        const markerUrl = 'https://images.vexels.com/media/users/3/154573/isolated/preview/bd08e000a449288c914d851cb9dae110-hatchback-car-top-view-silhouette-by-vexels.png'\n        const marker = document.querySelector(`[src=\"${markerUrl}\"]`)\n        console.log(\"marker\",marker);\n        \n        if (marker) { // when it hasn't loaded, it's null\n          marker.style.transform = `rotate(${actualAngle}deg)`\n        }\n        this.setState({routeCoordinates:progress})\n    })\n    .catch(err=>{\n      console.log(\"err\",err);\n    })\n  }\n\n\n  render() {\n    console.log(\"routeCoordinates\",this.state.routeCoordinates);\n    return (\n      <React.Fragment>\n      <div className=\"col-lg-12 col-md-12 col-sm-12 col-xs-12 NOPadding\">\n        <section className=\"content\">\n        <div className=\"pageContent col-lg-12 col-md-12 col-sm-12 col-xs-12\">\n          <div className=\"box-header with-border col-lg-12 col-md-12 col-xs-12 col-sm-12 NOpadding-right\">\n             <h4 className=\"weighttitle col-lg-8 col-md-11 col-xs-11 col-sm-11\">Tracking Map for Booking No. {this.state.bookingNum}</h4>\n          </div>\n          {this.state.routeCoordinates && this.state.routeCoordinates.length > 0 ?\n            <div className=\"col-lg-12 col-md-12 col-xs-12 col-xs-12 text-center\">\n              <MapWithAMarker\n                selectedMarker={this.state.selectedMarker}\n                markers={this.state.locations}\n                onClick={this.handleClick}\n                pathCoordinates={this.state.routeCoordinates}\n                googleMapURL=\"https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=geometry,drawing,places\"\n                loadingElement={<div style={{ height: `100%` }} />}\n                containerElement={<div style={{ height: `650px` }} />}\n                mapElement={<div style={{ height: `100%` }} />}\n              />\n             {/*<h1>Coming Soon</h1>*/}\n            </div> \n            :\n            null\n          }\n          </div>\n         </section>\n         </div>  \n      </React.Fragment>  \n    )\n  }\n}"]},"metadata":{},"sourceType":"module"}